(function(a){a.jgrid.inlineEdit=a.jgrid.inlineEdit||{};a.jgrid.extend({editRow:function(c,b,d,o,h,e,n,l,f){var j={},g=a.makeArray(arguments).slice(1);if("object"===a.type(g[0]))j=g[0];else if("undefined"!==typeof b&&(j.keys=b),a.isFunction(d)&&(j.oneditfunc=d),a.isFunction(o)&&(j.successfunc=o),"undefined"!==typeof h&&(j.url=h),"undefined"!==typeof e&&(j.extraparam=e),a.isFunction(n)&&(j.aftersavefunc=n),a.isFunction(l)&&(j.errorfunc=l),a.isFunction(f))j.afterrestorefunc=f;j=a.extend(!0,{keys:!1,
oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},a.jgrid.inlineEdit,j);return this.each(function(){var b=this,f,d,g=0,h=null,l={},e,k;if(b.grid&&(e=a(b).jqGrid("getInd",c,!0),!1!==e&&"0"==(a(e).attr("editable")||"0")&&!a(e).hasClass("not-editable-row")))k=b.p.colModel,a('td[role="gridcell"]',e).each(function(e){f=k[e].name;var j=!0===b.p.treeGrid&&f==b.p.ExpandColumn;if(j)d=a("span:first",this).html();
else try{d=a.unformat.call(b,this,{rowId:c,colModel:k[e]},e)}catch(o){d=k[e].edittype&&"textarea"==k[e].edittype?a(this).text():a(this).html()}if("cb"!=f&&"subgrid"!=f&&"rn"!=f&&(b.p.autoencode&&(d=a.jgrid.htmlDecode(d)),l[f]=d,!0===k[e].editable)){null===h&&(h=e);j?a("span:first",this).html(""):a(this).html("");var x=a.extend({},k[e].editoptions||{},{id:c+"_"+f,name:f});k[e].edittype||(k[e].edittype="text");if("&nbsp;"==d||"&#160;"==d||1==d.length&&160==d.charCodeAt(0))d="";var u=a.jgrid.createEl.call(b,
k[e].edittype,x,d,!0,a.extend({},a.jgrid.ajaxOptions,b.p.ajaxSelectOptions||{}));a(u).addClass("editable");j?a("span:first",this).append(u):a(this).append(u);a.jgrid.bindEv(u,x,b);"select"==k[e].edittype&&"undefined"!==typeof k[e].editoptions&&!0===k[e].editoptions.multiple&&"undefined"===typeof k[e].editoptions.dataUrl&&a.browser.msie&&a(u).width(a(u).width());g++}}),0<g&&(l.id=c,b.p.savedRow.push(l),a(e).attr("editable","1"),a("td:eq("+h+") input",e).focus(),!0===j.keys&&a(e).bind("keydown",function(d){if(27===
d.keyCode){a(b).jqGrid("restoreRow",c,j.afterrestorefunc);if(b.p._inlinenav)try{a(b).jqGrid("showAddEditButtons")}catch(f){}return!1}if(13===d.keyCode){if("TEXTAREA"==d.target.tagName)return!0;if(a(b).jqGrid("saveRow",c,j)&&b.p._inlinenav)try{a(b).jqGrid("showAddEditButtons")}catch(e){}return!1}}),a(b).triggerHandler("jqGridInlineEditRow",[c,j]),a.isFunction(j.oneditfunc)&&j.oneditfunc.call(b,c))})},saveRow:function(c,b,d,o,h,e,n){var l=a.makeArray(arguments).slice(1),f={};if("object"===a.type(l[0]))f=
l[0];else if(a.isFunction(b)&&(f.successfunc=b),"undefined"!==typeof d&&(f.url=d),"undefined"!==typeof o&&(f.extraparam=o),a.isFunction(h)&&(f.aftersavefunc=h),a.isFunction(e)&&(f.errorfunc=e),a.isFunction(n))f.afterrestorefunc=n;var f=a.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},a.jgrid.inlineEdit,f),j=!1,g=this[0],m,i={},v={},r={},t,s,q;if(!g.grid)return j;q=a(g).jqGrid("getInd",c,!0);if(!1===q)return j;
l=a(q).attr("editable");f.url=f.url?f.url:g.p.editurl;if("1"===l){var k;a('td[role="gridcell"]',q).each(function(b){k=g.p.colModel[b];m=k.name;if("cb"!=m&&"subgrid"!=m&&!0===k.editable&&"rn"!=m&&!a(this).hasClass("not-editable-cell")){switch(k.edittype){case "checkbox":var c=["Yes","No"];k.editoptions&&(c=k.editoptions.value.split(":"));i[m]=a("input",this).is(":checked")?c[0]:c[1];break;case "text":case "password":case "textarea":case "button":i[m]=a("input, textarea",this).val();break;case "select":if(k.editoptions.multiple){var c=
a("select",this),d=[];i[m]=a(c).val();i[m]=i[m]?i[m].join(","):"";a("select option:selected",this).each(function(c,b){d[c]=a(b).text()});v[m]=d.join(",")}else i[m]=a("select option:selected",this).val(),v[m]=a("select option:selected",this).text();k.formatter&&"select"==k.formatter&&(v={});break;case "custom":try{if(k.editoptions&&a.isFunction(k.editoptions.custom_value)){if(i[m]=k.editoptions.custom_value.call(g,a(".customelement",this),"get"),void 0===i[m])throw"e2";}else throw"e1";}catch(e){"e1"==
e&&a.jgrid.info_dialog(a.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,a.jgrid.edit.bClose),"e2"==e?a.jgrid.info_dialog(a.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.novalue,a.jgrid.edit.bClose):a.jgrid.info_dialog(a.jgrid.errors.errcap,e.message,a.jgrid.edit.bClose)}}s=a.jgrid.checkValues(i[m],b,g);if(!1===s[0])return s[1]=i[m]+" "+s[1],!1;g.p.autoencode&&(i[m]=a.jgrid.htmlEncode(i[m]));"clientArray"!==f.url&&k.editoptions&&!0===k.editoptions.NullIfEmpty&&
""===i[m]&&(r[m]="null")}});if(!1===s[0]){try{var p=a.jgrid.findPos(a("#"+a.jgrid.jqID(c),g.grid.bDiv)[0]);a.jgrid.info_dialog(a.jgrid.errors.errcap,s[1],a.jgrid.edit.bClose,{left:p[0],top:p[1]})}catch(y){alert(s[1])}return j}var w,l=g.p.prmNames;w=l.oper;p=l.id;i&&(i[w]=l.editoper,i[p]=c,"undefined"==typeof g.p.inlineData&&(g.p.inlineData={}),i=a.extend({},i,g.p.inlineData,f.extraparam));if("clientArray"==f.url){i=a.extend({},i,v);g.p.autoencode&&a.each(i,function(c,b){i[c]=a.jgrid.htmlDecode(b)});
p=a(g).jqGrid("setRowData",c,i);a(q).attr("editable","0");for(l=0;l<g.p.savedRow.length;l++)if(g.p.savedRow[l].id==c){t=l;break}0<=t&&g.p.savedRow.splice(t,1);a(g).triggerHandler("jqGridInlineAfterSaveRow",[c,p,i,f]);a.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(g,c,p,f);j=!0;a(q).unbind("keydown")}else a("#lui_"+a.jgrid.jqID(g.p.id)).show(),r=a.extend({},i,r),r[p]=a.jgrid.stripPref(g.p.idPrefix,r[p]),a.ajax(a.extend({url:f.url,data:a.isFunction(g.p.serializeRowData)?g.p.serializeRowData.call(g,
r):r,type:f.mtype,async:!1,complete:function(b,d){a("#lui_"+a.jgrid.jqID(g.p.id)).hide();if(d==="success"){var e=true,h;h=a(g).triggerHandler("jqGridInlineSuccessSaveRow",[b,c,f]);a.isArray(h)||(h=[true,i]);h[0]&&a.isFunction(f.successfunc)&&(h=f.successfunc.call(g,b));if(a.isArray(h)){e=h[0];i=h[1]?h[1]:i}else e=h;if(e===true){g.p.autoencode&&a.each(i,function(b,c){i[b]=a.jgrid.htmlDecode(c)});i=a.extend({},i,v);a(g).jqGrid("setRowData",c,i);a(q).attr("editable","0");for(e=0;e<g.p.savedRow.length;e++)if(g.p.savedRow[e].id==
c){t=e;break}t>=0&&g.p.savedRow.splice(t,1);a(g).triggerHandler("jqGridInlineAfterSaveRow",[c,b,i,f]);a.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(g,c,b);j=true;a(q).unbind("keydown")}else{a(g).triggerHandler("jqGridInlineErrorSaveRow",[c,b,d,null,f]);a.isFunction(f.errorfunc)&&f.errorfunc.call(g,c,b,d,null);f.restoreAfterError===true&&a(g).jqGrid("restoreRow",c,f.afterrestorefunc)}}},error:function(b,d,e){a("#lui_"+a.jgrid.jqID(g.p.id)).hide();a(g).triggerHandler("jqGridInlineErrorSaveRow",
[c,b,d,e,f]);if(a.isFunction(f.errorfunc))f.errorfunc.call(g,c,b,d,e);else{b=b.responseText||b.statusText;try{a.jgrid.info_dialog(a.jgrid.errors.errcap,'<div class="ui-state-error">'+b+"</div>",a.jgrid.edit.bClose,{buttonalign:"right"})}catch(h){alert(b)}}f.restoreAfterError===true&&a(g).jqGrid("restoreRow",c,f.afterrestorefunc)}},a.jgrid.ajaxOptions,g.p.ajaxRowOptions||{}))}return j},restoreRow:function(c,b){var d=a.makeArray(arguments).slice(1),o={};"object"===a.type(d[0])?o=d[0]:a.isFunction(b)&&
(o.afterrestorefunc=b);o=a.extend(!0,a.jgrid.inlineEdit,o);return this.each(function(){var b=this,d,n,l={};if(b.grid){n=a(b).jqGrid("getInd",c,true);if(n!==false){for(var f=0;f<b.p.savedRow.length;f++)if(b.p.savedRow[f].id==c){d=f;break}if(d>=0){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+a.jgrid.jqID(n.id)).datepicker("hide")}catch(j){}a.each(b.p.colModel,function(){this.editable===true&&this.name in b.p.savedRow[d]&&(l[this.name]=b.p.savedRow[d][this.name])});a(b).jqGrid("setRowData",
c,l);a(n).attr("editable","0").unbind("keydown");b.p.savedRow.splice(d,1);a("#"+a.jgrid.jqID(c),"#"+a.jgrid.jqID(b.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){a(b).jqGrid("delRowData",c)},0)}a(b).triggerHandler("jqGridInlineAfterRestoreRow",[c]);a.isFunction(o.afterrestorefunc)&&o.afterrestorefunc.call(b,c)}}})},addRow:function(c){c=a.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},c||{});return this.each(function(){if(this.grid){var b=
this;c.rowID=a.isFunction(c.rowID)?c.rowID.call(b,c):null!=c.rowID?c.rowID:a.jgrid.randId();!0===c.useDefValues&&a(b.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var d=this.editoptions.defaultValue,d=a.isFunction(d)?d.call(b):d;c.initdata[this.name]=d}});a(b).jqGrid("addRowData",c.rowID,c.initdata,c.position);c.rowID=b.p.idPrefix+c.rowID;a("#"+a.jgrid.jqID(c.rowID),"#"+a.jgrid.jqID(b.p.id)).addClass("jqgrid-new-row");if(c.useFormatter)a("#"+a.jgrid.jqID(c.rowID)+
" .ui-inline-edit","#"+a.jgrid.jqID(b.p.id)).click();else{var d=b.p.prmNames;c.addRowParams.extraparam[d.oper]=d.addoper;a(b).jqGrid("editRow",c.rowID,c.addRowParams);a(b).jqGrid("setSelection",c.rowID)}}})},inlineNav:function(c,b){b=a.extend({edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",addParams:{},editParams:{},restoreAfterSelect:!0},a.jgrid.nav,b||{});return this.each(function(){if(this.grid){var d=this,o,
h=a.jgrid.jqID(d.p.id);d.p._inlinenav=!0;if(!0===b.addParams.useFormatter){var e=d.p.colModel,n;for(n=0;n<e.length;n++)if(e[n].formatter&&"actions"===e[n].formatter){e[n].formatoptions&&(e=a.extend({keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},e[n].formatoptions),b.addParams.addRowParams={keys:e.keys,oneditfunc:e.onEdit,successfunc:e.onSuccess,url:e.url,extraparam:e.extraparam,aftersavefunc:e.afterSavef,errorfunc:e.onError,afterrestorefunc:e.afterRestore});
break}}b.add&&a(d).jqGrid("navButtonAdd",c,{caption:b.addtext,title:b.addtitle,buttonicon:b.addicon,id:d.p.id+"_iladd",onClickButton:function(){a(d).jqGrid("addRow",b.addParams);b.addParams.useFormatter||(a("#"+h+"_ilsave").removeClass("ui-state-disabled"),a("#"+h+"_ilcancel").removeClass("ui-state-disabled"),a("#"+h+"_iladd").addClass("ui-state-disabled"),a("#"+h+"_iledit").addClass("ui-state-disabled"))}});b.edit&&a(d).jqGrid("navButtonAdd",c,{caption:b.edittext,title:b.edittitle,buttonicon:b.editicon,
id:d.p.id+"_iledit",onClickButton:function(){var c=a(d).jqGrid("getGridParam","selrow");c?(a(d).jqGrid("editRow",c,b.editParams),a("#"+h+"_ilsave").removeClass("ui-state-disabled"),a("#"+h+"_ilcancel").removeClass("ui-state-disabled"),a("#"+h+"_iladd").addClass("ui-state-disabled"),a("#"+h+"_iledit").addClass("ui-state-disabled")):(a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+h,jqm:!0}),a("#jqg_alrt").focus())}});b.save&&(a(d).jqGrid("navButtonAdd",c,{caption:b.savetext||"",title:b.savetitle||"Save row",
buttonicon:b.saveicon,id:d.p.id+"_ilsave",onClickButton:function(){var c=d.p.savedRow[0].id;if(c){var e=d.p.prmNames,j=e.oper;b.editParams.extraparam||(b.editParams.extraparam={});b.editParams.extraparam[j]=a("#"+a.jgrid.jqID(c),"#"+h).hasClass("jqgrid-new-row")?e.addoper:e.editoper;a(d).jqGrid("saveRow",c,b.editParams)&&a(d).jqGrid("showAddEditButtons")}else a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+h,jqm:!0}),a("#jqg_alrt").focus()}}),a("#"+h+"_ilsave").addClass("ui-state-disabled"));b.cancel&&
(a(d).jqGrid("navButtonAdd",c,{caption:b.canceltext||"",title:b.canceltitle||"Cancel row editing",buttonicon:b.cancelicon,id:d.p.id+"_ilcancel",onClickButton:function(){var c=d.p.savedRow[0].id;if(c){a(d).jqGrid("restoreRow",c,b.editParams);a(d).jqGrid("showAddEditButtons")}else{a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+h,jqm:true});a("#jqg_alrt").focus()}}}),a("#"+h+"_ilcancel").addClass("ui-state-disabled"));!0===b.restoreAfterSelect&&(o=a.isFunction(d.p.beforeSelectRow)?d.p.beforeSelectRow:
!1,d.p.beforeSelectRow=function(c,e){var h=true;if(d.p.savedRow.length>0&&d.p._inlinenav===true&&c!==d.p.selrow&&d.p.selrow!==null){d.p.selrow==b.addParams.rowID?a(d).jqGrid("delRowData",d.p.selrow):a(d).jqGrid("restoreRow",d.p.selrow,b.editParams);a(d).jqGrid("showAddEditButtons")}o&&(h=o.call(d,c,e));return h})}})},showAddEditButtons:function(){return this.each(function(){if(this.grid){var c=a.jgrid.jqID(this.p.id);a("#"+c+"_ilsave").addClass("ui-state-disabled");a("#"+c+"_ilcancel").addClass("ui-state-disabled");
a("#"+c+"_iladd").removeClass("ui-state-disabled");a("#"+c+"_iledit").removeClass("ui-state-disabled")}})}})})(jQuery);